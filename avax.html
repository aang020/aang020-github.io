 <html>
	<head>
		<title>Avax</title>
		<style>
			body {
				background-color: black;
				color: white;
			}
			table {
				color: white;
			}
			a {
				color:white;
			}
		</style>
	</head>
	<body>
<!-- 
	https://aang020.github.io/aang020-github.io/test.html

-->

	<h5> Avax</h5> 
	<input type='text' id='search' />	
	 
	<a href='https://cchain.explorer.avax.network/address/0x19e4912DA337024d754b26182ac7177F7D3E2a45/token-transfers'>Neo Avax </a> <br/>
	<div class='result'>
		test
	</div>	

	<script src="https://code.jquery.com/jquery-3.5.1.min.js" ></script>
	<script>
 	$(document).ready(function() {
		var all_addr = {'theodore_detweiler':'0x5Eb67a3b141f3036899EE77822A41277166c540e','khalil':'0x780709dffad3aaf57bf38f2d035980be389dc8ff','defiPunts':'0xf817554cc4ca4fe435dbf43bd1bacf0d7b0f38d7','duke_rick':'0xa72dd12b9329e6efe095c030f361131604a79586','lordAlpha':'0xb290fd44a628a21fccbf6347668d80de4177da42','neo_chimp':'0x19e4912da337024d754b26182ac7177f7d3e2a45','H3R3TiKALL':'0x7f581b389345835138Dc43F2ade09Be91916078b' ,'AvaxMaster':'0x2dd8A2B5be93BF1C88a967344646Cdc07e27D926','cryptamurai':'0x9b7d7c4ce98036c4d6f3d638a00e220e083116c7','azima':'0x9d156bc7c8768294510a4a41883d5a4eb15b15e3','DefiPunt':'0x580d1f2f40deb2a3e293a57567ae71e58df655cc'};
		//var all_addr = {'duke_rick':'0xa72dd12b9329e6efe095c030f361131604a79586'};

		// do research 
		// 0x780709DffaD3AaF57bF38F2D035980Be389dc8FF  // added more mim to avax chain  than  theodore 
		//  0x73d38D824fb2a24d1D888DA0E582A850CB34343b  // added more mim to avax chain than  theodore 
 
		var url = '';		
		callingAlpha();

		function callingAlpha() {
			window.final = [];
			window.userCnt=0;
			$(".result").html('Loading...');

			$.each(all_addr,function(name,addr){ 
				getData(name,addr); 

			})
		}
	 
		function getData(name,addr) {
			//console.log('this call '+1);
			//
			//var url = "https://api.covalenthq.com/v1/43114/address/"+addr+"/balances_v2/?&key=ckey_878fb2b8cf01405ca98bfa35581";
			var url ="https://api.covalenthq.com/v1/43114/address/"+addr+"/transactions_v2/?page-size=10&limit=10&key=ckey_878fb2b8cf01405ca98bfa35581";
			//console.log(url);
			
			var defDecimal =1000000000000000000;
			var tk = []
			tk[6]=1000000;
			tk[8]=1000000000;
			tk[18]=defDecimal;

			jQuery.ajaxSetup({async:false});

			$.get( url, function( response ) {
				var result = response.data.items;
				var userData = {};
				//console.log(result);

				 $.each(result,function(l,m){
				 	//console.log(m);
				 	$.each(m.log_events,function(k,t){
				 		if(t.decoded && t.decoded.name == "Transfer" && t.decoded.params[1].value == addr.toLowerCase()) {

				 			 
					 			var tokenVal =0;
						  		var dec = '';

					 			tokenVal = t.decoded.params[2].value;
					 			dec = t.sender_contract_decimals;
							  	if(dec == 6 || dec == 8 || dec == 18) {

							  		tokenVal = tokenVal/tk[dec];
							  		//console.log(v.value+' '+tk[dec]+' '+tokenVal);
							  	}
					 			//console.log('Name '+t.sender_name+' Addr '+t.sender_contract_ticker_symbol+' value '+tokenVal)

					 			row = {};
							
								row['tx_hash']=m.tx_hash;
								row['tokenName'] =t.sender_name;
								row['tokenSymbol'] =t.sender_contract_ticker_symbol;
								row['contractAddr'] =  t.sender_address ; //(v.from == addr ) ? v.to : v.from;
								row['tokenVal'] =tokenVal;
								row['timeStamp'] = m.block_signed_at;// new Date().getTime();
								row['nickName']=name;
								row['userAddr']=addr;

								//console.log('adding to row ');
								//console.log(t.decoded);
								//console.log(t.sender_contract_ticker_symbol);
								//console.log('T d '+t.decoded.params[1].value+ ' addr '+addr);
								window.final.push(row);
							 
				 		}

				 		//console.log( t);
				 	})
				 	
				 	
					
				})
				
				/*
				$.each(result,function(k,v){
					theDate = new Date(v.updated_at);
					 var tokenVal =0;
					  var dec = '';


				  	dec =v.contract_decimals;
				  	tokenVal = v.balance;
				  	if(dec == 6 || dec == 8 || dec == 18) {

				  		tokenVal = v.balance/tk[dec];
				  		//console.log(v.value+' '+tk[dec]+' '+tokenVal);
				  	}
				  	row = {};
					
					row['tokenName'] =v.contract_name;
					row['tokenSymbol'] =v.contract_ticker_symbol;
					row['contractAddr'] =  v.contract_address ; //(v.from == addr ) ? v.to : v.from;
					row['tokenVal'] =tokenVal;
					row['timeStamp'] =v.updated_at;
					row['nickName']=name;
					row['userAddr']=addr;

					window.final.push(row);
				}) 
				*/
				 window.userCnt++;
			})
			.done(function(){
 
				var length =  Object.keys(all_addr).length;
				//console.log('length '+length+' window length'+window.final.length+' user cnt '+window.userCnt+" bool|"+(length == window.userCnt)+"|");
				if(length == window.userCnt) { 
					//console.log('make table');
					makeTbl();
				}
				
			});

		}

		// 4763  - 1499 rank 
		// 7906 - 1257 rank 
		// 7914 - 1747 rank
		// 7915 - 736 rank 


		function makeTbl() {
			var chain = $("#chain").val();
			//console.log('making the table');
			var finalVals = window.final;
			finalVals.sort(getSorted('timeStamp'));
			
			//console.log('final values');
			//console.log(finalVals	);
			 var html = "<table border=1 style='border-collapse:collapse;'>";
		  html += "<tr>";
		  html+='<td>From </td>';
		  html+='<td>Token Name</td>';
		  html+='<td>Symbol</td>';
		  html+='<td>Addr</td>';
		  html+='<td>Value</td>';
		   html+="<td>Time</td>"; 
		  html+="<td>Link</td>"; 

		  html+='</tr>';
		  var str ='';
		  $.each(finalVals,function(k,v){ 
		  	theDate = new Date(v.timeStamp);

		  	dec =v.tokenDecimal;
		  	tokenVal = v.tokenVal;
		  	str ='';
		   	if(k%2 ==0) {
		   		str =' class= "odd" ';
		   	}
			html += "<tr "+str+"> ";
			html+='<td><a href="https://avascan.info/blockchain/c/address/'+v.userAddr+'"  target="_blank">'+v.nickName+' </a></td>';
			html+='<td>'+v.tokenName+'</td>';
			html+='<td>'+v.tokenSymbol+'</td>';
			html+='<td>'+v.contractAddr+'</td>';
			html+='<td>'+tokenVal+'</td>';
			html+='<td>'+new Date(v.timeStamp).toLocaleString()+'</td>';
			html+='<td><a href="https://cchain.explorer.avax.network/address/'+v.userAddr+'/token-transfers" target="_blank">Addr</a></td>';
			html+='</tr>';
		  	 
		  })
		  html+='</table>';
		  $(".result").html(html);
 
		}
		function getSorted(prop) 
		{
			return function(a,b) {
				if(a[prop] < b[prop]) {	
					return 1;
				}
				else if(a[prop] > b[prop]) {
					return -1;
				}
				return 0;
			}
		}

		$("#search").on("keyup", function() {
		    var value = $(this).val();

		    $("table tr").each(function(index) {
		        if (index != 0) {

		            $row = $(this);

		            var id = $row.find("td:nth-child(1)").text().toLowerCase();

		            if (id.indexOf(value) != 0) {
		                $(this).hide();
		            }
		            else {
		                $(this).show();
		            }
		        }
		    });
		});


	});
	</script>
	</body>
</html>

